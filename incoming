#!/usr/bin/env bash
#
# add this to crontab
# */1 * *  *  * /usr/local/bin/incoming /var/www/apt-repo/incoming
#

INCOMING=$1
CODENAME=trusty

cd /var/www/apt-repo
found=0
for f in $INCOMING/*.deb; do
    if [ -e $f ]; then
        found=1
        break
    fi
done

if [[ $found == 0 ]]; then
    echo "Nothing to do"
    exit
fi

for f in $INCOMING/*.deb; do
    echo "Processing $f"
    reprepro -Vb . includedeb $CODENAME $f
    rm  $f
done
